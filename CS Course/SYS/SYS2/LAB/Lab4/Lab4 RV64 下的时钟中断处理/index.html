
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="吴梓聪(CCnocc)">
      
      
        <link rel="canonical" href="https://zjuccnocc.github.io/CS%20Course/SYS/SYS2/LAB/Lab4/Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86/">
      
      
        <link rel="prev" href="../../Lab3/Lab3%EF%BC%9ARV64%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">
      
      
        <link rel="next" href="../../Lab5/Lab5%EF%BC%9ARV64%20%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6/">
      
      
      <link rel="icon" href="../../../../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>Lab4 - CCnocc Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
    
      
    
    
  
    
    
      
    
    
  
    
    
      
    
    
  
  
  <style>.md-tag.md-tag--default-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M0 80v149.5c0 17 6.7 33.3 18.7 45.3l176 176c25 25 65.5 25 90.5 0l133.5-133.5c25-25 25-65.5 0-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7H48C21.5 32 0 53.5 0 80zm112 32a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>');}.md-tag.md-tag--hardware-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M176 24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c-35.3 0-64 28.7-64 64H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40v56H24c-13.3 0-24 10.7-24 24s10.7 24 24 24h40c0 35.3 28.7 64 64 64v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40h56v40c0 13.3 10.7 24 24 24s24-10.7 24-24v-40c35.3 0 64-28.7 64-64h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40v-56h40c13.3 0 24-10.7 24-24s-10.7-24-24-24h-40c0-35.3-28.7-64-64-64V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56V24c0-13.3-10.7-24-24-24s-24 10.7-24 24v40h-56V24zm-16 104h192c17.7 0 32 14.3 32 32v192c0 17.7-14.3 32-32 32H160c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32zm192 32H160v192h192V160z"/></svg>');}.md-tag.md-tag--software-tag{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 96c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256h-64V96H128v256H64V96zM0 403.2C0 392.6 8.6 384 19.2 384h601.6c10.6 0 19.2 8.6 19.2 19.2 0 42.4-34.4 76.8-76.8 76.8H76.8C34.4 480 0 445.6 0 403.2zM281 209l-31 31 31 31c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-48-48c-9.4-9.4-9.4-24.6 0-33.9l48-48c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9zm112-34 48 48c9.4 9.4 9.4 24.6 0 33.9l-48 48c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/></svg>');}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/counter.css">
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/custom.css">
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/glightbox.min.css">
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/galaxy.css">
    
      <link rel="stylesheet" href="https://cdn.tonycrane.cc/utils/katex.min.css">
    
      <link rel="stylesheet" href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css">
    
      <link rel="stylesheet" href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab4-rv64" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../../.." title="CCnocc Blog" class="md-header__button md-logo" aria-label="CCnocc Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CCnocc Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab4
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.11 21.46 2.39 1.73 1.11 3l3.86 3.86L3.34 7l1.77 3.79c.14-.79.39-1.55.83-2.29.06-.14.19-.26.28-.39l1.44 1.44C7.25 10.27 7 11.11 7 12c0 2.76 2.24 5 5 5 .9 0 1.73-.25 2.45-.66l6.39 6.39 1.27-1.27M12 15c-1.66 0-3-1.34-3-3 0-.33.07-.64.17-.94l3.77 3.77c-.3.1-.61.17-.94.17m6.05-6.5c-.42-.72-.95-1.35-1.55-1.86l4.15.36-1.77 3.79c-.14-.79-.41-1.56-.83-2.29M12 7c2.76 0 5 2.24 5 5 0 .54-.11 1.05-.26 1.54L15 11.78A3.057 3.057 0 0 0 12.22 9l-1.75-1.73c.48-.16.99-.27 1.53-.27m0-2c-.84 0-1.65.15-2.39.42L12 2l2.39 3.42C13.65 5.15 12.84 5 12 5m6.87 8.21L20.64 17l-.4.04-1.99-1.99c.29-.6.51-1.21.62-1.84M12 19c.82 0 1.63-.17 2.37-.44L12 22l-2.41-3.44c.74.27 1.55.44 2.41.44m-6.05-3.5c.42.74.96 1.36 1.55 1.87L3.36 17l1.76-3.77c.14.77.41 1.55.83 2.27Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZJUccnocc/ZJUccnocc.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ZJUCCnoccBlogSource
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../../" class="md-tabs__link">
          
  
    
  
  CS Course

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../General%20Course/" class="md-tabs__link">
          
  
    
  
  General Course

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../BlogWriteup/" class="md-tabs__link">
          
  
    
  
  Blog Writeup

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../Major%20Relative/" class="md-tabs__link">
          
  
    
  
  Major Relative

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="CCnocc Blog" class="md-nav__button md-logo" aria-label="CCnocc Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    CCnocc Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZJUccnocc/ZJUccnocc.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ZJUCCnoccBlogSource
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../.." class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    CS Course
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            CS Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../DJJ/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机科学基础（B）
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../XAY/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    信息安全原理与数理基础
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机系统
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            计算机系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    
  
  
    <a href="../../../../SYS1/LAB/Lab0-1%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机系统Ⅰ
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_3" id="__nav_2_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机系统Ⅱ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_3">
            <span class="md-nav__icon md-icon"></span>
            计算机系统Ⅱ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4_3_1" id="__nav_2_4_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    实验部分
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_4_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4_3_1">
            <span class="md-nav__icon md-icon"></span>
            实验部分
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab0/Lab5%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab1/Lab1%20Pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab2/Lab2%20Forwarding%20%E5%8F%8A%20AXI4-lite%20%E6%80%BB%E7%BA%BF%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab3/Lab3%EF%BC%9ARV64%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Lab4
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Lab4
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#3220103648" class="md-nav__link">
    <span class="md-ellipsis">
      3220103648 吴梓聪
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab5/Lab5%EF%BC%9ARV64%20%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab6/Lab6%EF%BC%9A%E7%BB%BC%E5%90%88%E5%AE%9E%E9%AA%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab6
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../Machine%20Learning/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../TC/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    技术沟通
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../../General%20Course/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    General Course
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../../BlogWriteup/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Blog Writeup
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../../../../Major%20Relative/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Major Relative
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#3220103648" class="md-nav__link">
    <span class="md-ellipsis">
      3220103648 吴梓聪
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="lab4-rv64">Lab4 RV64 下的时钟中断处理<a class="headerlink" href="#lab4-rv64" title="点击此处可置顶内容">&para;</a></h1>
<h2 id="3220103648">3220103648 吴梓聪<a class="headerlink" href="#3220103648" title="点击此处可置顶内容">&para;</a></h2>
<h1 id="1">1 实验目的<a class="headerlink" href="#1" title="点击此处可置顶内容">&para;</a></h1>
<ul>
<li>学习 RISC-V 的异常处理相关寄存器与指令，通过本次完成对异常处理的初始化</li>
<li>理解 CPU 上下文切换机制，并正确实现上下文切换功能</li>
<li>编写异常处理函数，完成对特定异常的处理</li>
<li>调用 OpenSBI 提供的接口，完成对时钟中断事件的设置</li>
</ul>
<h1 id="2">2 背景知识<a class="headerlink" href="#2" title="点击此处可置顶内容">&para;</a></h1>
<h2 id="21">2.1 控制状态寄存器<a class="headerlink" href="#21" title="点击此处可置顶内容">&para;</a></h2>
<p>本实验只专注于 Supervisor 模式下的控制状态寄存器，包括：<code>sstatus</code> ，<code>sie</code> ，<code>stvec</code> ，<code>scause</code> ，<code>sepc</code> 等。</p>
<h3 id="211-sstatussupervisor-status-register">2.1.1 <code>sstatus</code>(Supervisor Status Register)<a class="headerlink" href="#211-sstatussupervisor-status-register" title="点击此处可置顶内容">&para;</a></h3>
<p>如下图是从《Risc-V Privileged》手册上扒下来的32位与64位系统下，<code>sstatus</code> 寄存器的各个位的分布：</p>
<p><img alt="image-20240210211231085" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211231085.png" /></p>
<p>在其中我们需要特别关注的是：SIE和SPP以及SPIE。</p>
<h4 id="2111-sie">2.1.1.1 SIE<a class="headerlink" href="#2111-sie" title="点击此处可置顶内容">&para;</a></h4>
<blockquote>
<p>The SIE bit enables or disables all interrupts in supervisor mode. When SIE is clear, interrupts are not taken while in supervisor mode. When the hart is running in user-mode, the value in SIE is ignored, and supervisor-level interrupts are enabled. The supervisor can disable individual interrupt sources using the SIE CSR——《Risc-V Privileged》</p>
</blockquote>
<p>意思是SIE主要作用为开启Supervisor模式下的所有中断的使能。如果是0的话则不会在Supervisor模式下接受任何中断。是1的话才会在Supervisor模式下执行这一层中产生的中断。</p>
<p>当在用户模式下运行时，SIE的值将不再重要，Supervisor模式下的中断将都被开启。</p>
<h4 id="2112-spp">2.1.1.2 SPP<a class="headerlink" href="#2112-spp" title="点击此处可置顶内容">&para;</a></h4>
<blockquote>
<p>The SPP bit indicates the privilege level at which a hart was executing before entering supervisor mode. When a trap is taken, SPP is set to 0 if the trap originated from user mode, or 1 otherwise. When an SRET instruction (see Section 3.3.2) is executed to return from the trap handler, the privilege level is set to user mode if the SPP bit is 0, or supervisor mode if the SPP bit is 1; SPP is then set to 0.——《Risc-V Privileged》</p>
</blockquote>
<p>SPP这一位是用于记录进入Supervisor模式前指令流（hart）的特权级别状态。当异常（来自软件或硬件的中断）发生时，如果这个异常是来自于用户态的话，SPP会被设置成0，否则被设置为1。</p>
<p>当遇到了SRET指令时，会根据SPP位上的数据来设置返回指令流时的特权级别状态。最后SPP还会被设置回0。</p>
<h4 id="2113-spie">2.1.1.3 SPIE<a class="headerlink" href="#2113-spie" title="点击此处可置顶内容">&para;</a></h4>
<blockquote>
<p>The SPIE bit indicates whether supervisor interrupts were enabled prior to trapping into supervisor mode. When a trap is taken into supervisor mode, SPIE is set to SIE, and SIE is set to 0. When an SRET instruction is executed, SIE is set to SPIE, then SPIE is set to 1.——《Risc-V Privileged》</p>
</blockquote>
<p>SPIE位指示在捕获到 Supervisor 模式之前是否启用了Supervisor的中断。当一个异常（来自软件或硬件）进入到Suporvisor模式时，SPIE被设置为SIE，SIE被设置为0。</p>
<p>当执行SRET指令时，SIE被设置回为SPIE，然后SPIE被设置为1。</p>
<h3 id="212-sie-supervisor-interrupt-enable">2.1.2 <code>SIE</code> （Supervisor Interrupt Enable）<a class="headerlink" href="#212-sie-supervisor-interrupt-enable" title="点击此处可置顶内容">&para;</a></h3>
<p>如下图是从《Risc-V Privileged》手册上扒下来的 <code>sie</code> 寄存器的各个位的分布：</p>
<p><img alt="image-20240210211244836" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211244836.png" /></p>
<p>由图可知，这个 <code>sie</code> 寄存器一共只有16位。其中的SSIE，STIE，SEIE分别指的是：Supervisor Software( Timer , External ) Interrupt enable，也就是三种中断（软件，时钟，终端）。</p>
<p>当 <code>sstatus</code> 中的 <code>sie</code> 位，也就是第二位是 0 时，<code>sie</code> 寄存器中的值就不重要了。但是当 <code>sstatus</code> 中的 <code>sie</code> 位是 1 时，中断是否生效会根据 <code>sie</code> 寄存器中的三个位上的值来决定。</p>
<h3 id="213-stvec-supervisor-trap-vector-base-address-register">2.1.3 <code>stvec</code> （Supervisor Trap Vector base address register）<a class="headerlink" href="#213-stvec-supervisor-trap-vector-base-address-register" title="点击此处可置顶内容">&para;</a></h3>
<p>如下图是从《Risc-V Privileged》手册上扒下来的 <code>stvec</code> 寄存器的各个位的分布：</p>
<p><img alt="image-20240210211248320" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211248320.png" /></p>
<p><img alt="image-20240210211251178" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211251178.png" /></p>
<p>如图我们可以看到 <code>stvec</code> 是由BASE和MODE两个部分组成的。因为我们在本次实验中只用Direct模式，也就是MODE位为1。然后BASE部分需要设置成处理异常信号的指令的地址处。</p>
<h3 id="214-scausesupervisor-cause-register">2.1.4 <code>scause</code>（Supervisor Cause Register）<a class="headerlink" href="#214-scausesupervisor-cause-register" title="点击此处可置顶内容">&para;</a></h3>
<p>如下图是从《Risc-V Privileged》手册上扒下来的 <code>scause</code> 寄存器的各个位的分布：</p>
<p><img alt="image-20240210211254090" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211254090.png" /></p>
<p>这个是 <code>Exception Code</code> 的参数表：</p>
<p><img alt="image-20240210211256064" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211256064.png" /></p>
<p>同样可以看到 <code>scause</code> 由两个部分组成：最高位 <code>Interrupt</code> 部分和 <code>Exception Code</code> 部分。其中Interrupt部分表示是否是由 <code>Interrupt</code> 产生的，如果是0表示是由软件引起的异常。</p>
<p>本次实验需要处理的是Supervisor timer interrupt。也就是 <code>Exception Code = 5</code> 的情况。那么我们只需要把当前这个 <code>scause</code> 寄存器的值设置为 <code>0x80000005</code> 即可。</p>
<h3 id="215-sepc-supervisor-exception-pc-register">2.1.5 <code>sepc</code> （Supervisor Exception PC Register）<a class="headerlink" href="#215-sepc-supervisor-exception-pc-register" title="点击此处可置顶内容">&para;</a></h3>
<p>用于储存中断发生处的地址，在中断处理结束后返回这个地址，恢复执行位置。 </p>
<h2 id="22">2.2 特权指令<a class="headerlink" href="#22" title="点击此处可置顶内容">&para;</a></h2>
<p>控制状态寄存器需要特定的特权指令才能进行操作。</p>
<h3 id="221-csrcsrrcsrw">2.2.1 CSR读写指令（<code>csrr</code>，<code>csrw</code>等）<a class="headerlink" href="#221-csrcsrrcsrw" title="点击此处可置顶内容">&para;</a></h3>
<p>所有CSR指令都以原子方式读取、修改、写入一个CSR。</p>
<ul>
<li><code>csrr</code></li>
<li>
<p>用于读取一个 CSR 的值到通用寄存器，例如：
    <code>csrr rd, sstatus</code> 是将 <code>sstatus</code> 的值写入到 <code>rd</code> 寄存器中。</p>
</li>
<li>
<p><code>csrw</code></p>
</li>
<li>
<p>把一个通用寄存器中的值写入 CSR 中，例如：
    <code>csrw sstatus, rs1</code> 是将 <code>rs1</code> 的值写入 <code>sstatus</code>。</p>
</li>
<li>
<p><code>csrs</code></p>
</li>
<li>
<p>把 CSR 中指定的 bit 置 1，例如：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nf">li</span><span class="w">    </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="no">n</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nf">csrs</span><span class="w">  </span><span class="no">sstatus</span><span class="p">,</span><span class="w"> </span><span class="no">a0</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1">#==完全等价于==&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nf">csrsi</span><span class="w"> </span><span class="no">sstatus</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="no">n</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="c1">#这是将 sstatus 的右起第 n+1 位置 1。</span>
</span></code></pre></div>
</li>
<li>
<p><code>csrc</code> 基本一致，只是起到置 0 的效果。</p>
</li>
<li>
<p><code>csrrw</code> </p>
</li>
<li>读取一个 CSR 的值到通用寄存器，然后把另一个值写入该 CSR，例如：
    <code>csrrw rd, sstatus, rs1</code> 是将 <code>sstatus</code> 的值与存入到 <code>rd</code> 中，然后将 <code>rs1</code> 的值放入 <code>sstatus</code> 中。</li>
<li>同理由 <code>csrrs</code> 和 <code>csrrc</code> 两条指令。</li>
</ul>
<h3 id="222-sretmret">2.2.2 控制流转移指令（<code>sret</code>，<code>mret</code>）<a class="headerlink" href="#222-sretmret" title="点击此处可置顶内容">&para;</a></h3>
<p>此处的 <code>sret</code> 和 <code>mret</code> 分别是用于 S 态和 M 态的异常返回，在异常程序处理结束后，执行 <code>sret</code> 或 <code>mret</code> ，会将 <code>sepc</code> 或 <code>mepc</code> 再放回 <code>pc</code> 中， 返回到之前程序继续运行。</p>
<h2 id="23">2.3 异常处理流程图<a class="headerlink" href="#23" title="点击此处可置顶内容">&para;</a></h2>
<p>最后附一张晶晶姐直播回放上扒下来的异常处理流程图，据说最后会有用（）</p>
<p><img alt="image-20240210211302202" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211302202.png" /></p>
<h2 id="24">2.4 上下文处理<a class="headerlink" href="#24" title="点击此处可置顶内容">&para;</a></h2>
<p>由于在处理异常时，有可能会改变系统的状态。所以在真正处理异常之前，我们有必要对系统的当前状态进行保存，在异常处理完成之后，我们再将系统恢复至原先的状态，就可以确保之前的程序继续正常运行。</p>
<p>这里的系统状态通常是指寄存器，这些寄存器也叫做 CPU 的上下文 (<code>Context</code> ).</p>
<h2 id="25">2.5 异常处理程序<a class="headerlink" href="#25" title="点击此处可置顶内容">&para;</a></h2>
<p>异常处理程序会根据 <code>scause</code> 的值， 进入不同的处理逻辑，在本次试验中我们需要关心的只有 <code>Superviosr Timer Interrupt</code>。也就是在2.1.4中提到的部分。</p>
<h1 id="3">3 实验步骤<a class="headerlink" href="#3" title="点击此处可置顶内容">&para;</a></h1>
<h2 id="31">3.1 准备工程<a class="headerlink" href="#31" title="点击此处可置顶内容">&para;</a></h2>
<p>先根据手册给的示意图，将Lab3中对应的文件复制到这个文件夹下，形成一个与手册相一致的文件架构。</p>
<p><img alt="image-20240210211308598" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211308598.png" /> <img alt="image-20240210211305849" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211305849.png" /> </p>
<p>然后再根据手册里的提示，对 <code>vmlinux.lds</code> 和 <code>head.S</code> 以及 <code>init/test.c</code> 做出对应的修改：</p>
<ul>
<li>
<p>对 <code>vmlinux.lds</code> 的修改：在text段增加一个段标号 <code>.text.init</code> ，放在 <code>.text.entry</code> 之前，用于执行初始化的代码。</p>
</li>
<li>
<p>对 <code>head.S</code> 的修改：将 <code>_start</code> 这一标号的位置调整至新的段 <code>.text.init</code> 之中。</p>
</li>
<li>
<p>对 <code>init/test.c</code> 的修改：
  <div class="language-C highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="w"> </span><span class="n">原先的</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">c</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="p">...</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="o">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">修改之后的</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">c</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">...</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">record_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">present_time</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">__asm__</span><span class="w"> </span><span class="k">volatile</span><span class="p">(</span><span class="s">&quot;rdtime %[t]&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">present_time</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;memory&quot;</span><span class="p">);</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="n">present_time</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">10000000</span><span class="p">;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">record_time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">present_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;kernel is running! Time: %lus</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">present_time</span><span class="p">);</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="n">record_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">present_time</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<h2 id="32">3.2 开启异常处理<a class="headerlink" href="#32" title="点击此处可置顶内容">&para;</a></h2>
<p>从代码顺序上应该是先设置好 <code>stvec</code> ，将异常处理函数的入口地址存入 <code>stvec</code> 寄存器之中，再开启时钟中断，然后设置好第一次的时钟中断后再开启S态下的中断响应。但是为了调试每一个分步骤是否正确，我们选择先编写开启时钟中断和中断响应的部分，再完成后续的部分。</p>
<ul>
<li>开启时钟中断：</li>
</ul>
<p>在2.1.2 对 <code>SIE</code> 的介绍中，我们知道SIE的第六位是对应的时钟中断开启，因此我们的代码就应该是：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nf">li</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nf">csrs</span><span class="w"> </span><span class="no">sie</span><span class="p">,</span><span class="w"> </span><span class="no">a0</span><span class="w">  </span><span class="c1">#表示使得SIE第六位被置为1。</span>
</span></code></pre></div>
<ul>
<li>开启中断相应：</li>
</ul>
<p>在2.1.1对 <code>sstatus</code> 的介绍中，我们知道 <code>sstatus</code> 的第二位为1时表示可以 Supervisor 阶段的 interrupt 的开启。那么同样的我们的代码就应该是：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nf">li</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">&lt;&lt;</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nf">csrs</span><span class="w"> </span><span class="no">sstatus</span><span class="p">,</span><span class="w"> </span><span class="no">a0</span><span class="w">  </span><span class="c1">#表示 sstatus 的第二位被置1。</span>
</span></code></pre></div>
<ul>
<li>对应的debug：</li>
</ul>
<p>因为无论是使用 <code>spike</code> 还是 <code>qemu</code> 来 debug，我们都需要先获得Image镜像文件，那么我们首先需要对我们的工程文件进行编译。也就是首先需要对我们的 <code>Makefile</code> 体系做出对应的修改，这一部分在3.6中会详细的阐述，此处不作赘述。</p>
<p>除此之外还因为在编译前需要先完成 <code>entry.S</code> 的部分，所以我们后面的内容先按兵不动。</p>
<ul>
<li>设置 <code>stvec</code> 即异常处理函数的入口：</li>
</ul>
<p>因为一条指令的长度是32位，那么每一个pc的跨度就是4，也就是0b100，所以一个地址的低两位一定是0b00。因为我们这时候用的是Direct模式，所以不需要做额外处理。实现代码如下：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nf">la</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="no">_traps</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nf">csrw</span><span class="w"> </span><span class="no">stvec</span><span class="p">,</span><span class="w"> </span><span class="no">a0</span>
</span></code></pre></div>
<ul>
<li>设置第一次的时钟中断：</li>
</ul>
<p>我们参考3.5的实现逻辑来完成这一部分代码，但是需要额外注意的事情是，因为在这个部分出现了函数的调用，所以我们需要在这个部分前开辟好一块栈空间，代码如下：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nf">rdtime</span><span class="w"> </span><span class="no">a0</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nf">li</span><span class="w"> </span><span class="no">t0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000000</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nf">add</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="no">t0</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nf">la</span><span class="w">  </span><span class="no">sp</span><span class="p">,</span><span class="w"> </span><span class="no">_end</span><span class="err">+</span><span class="mi">0x1000</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nf">call</span><span class="w"> </span><span class="no">sbi_set_timer</span>
</span></code></pre></div>
<h2 id="33">3.3 实现上下文切换<a class="headerlink" href="#33" title="点击此处可置顶内容">&para;</a></h2>
<p>我们要使用汇编实现上下文切换机制，需要修改 <code>./arch/riscv/kernel/</code> 目录下的 <code>entry.S</code> 文件，共包含以下几个步骤：</p>
<ol>
<li>
<p>保存 CPU 的寄存器（上下文）到内存中（栈上）。</p>
</li>
<li>
<p>将 <code>scause</code> 和 <code>sepc</code> 中的值传入异常处理函数 <code>trap_handler</code>。</p>
</li>
</ol>
<p>（<code>trap_handler</code> 在 3.4 中实现，我们将会在 <code>trap_handler</code> 中实现对异常的处理。）</p>
<ol start="3">
<li>
<p>在完成对异常的处理之后， 我们从内存中（栈上）恢复 CPU 的寄存器（上下文）。</p>
</li>
<li>
<p>从 trap 中返回。</p>
</li>
</ol>
<p>实现代码如下，注释如下：</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span><span class="na">.section</span><span class="w"> </span><span class="no">.text.entry</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="na">.align</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="na">.globl</span><span class="w"> </span><span class="no">_traps</span><span class="w"> </span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="no">_traps</span><span class="p">:</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="c1"># YOUR CODE HERE</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="c1"># -----------</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">        </span><span class="c1"># 1. save 32 registers and sepc to stack</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">        </span><span class="c1"># sp,ra,gp,x4,t0~t6,s0~s11,a0~a7,fp 共计32个指针依次存入栈，每一个占用8位地址。</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nf">sd</span><span class="w"> </span><span class="no">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">-08</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="nf">sd</span><span class="w"> </span><span class="no">ra</span><span class="p">,</span><span class="w"> </span><span class="mi">-16</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="na">...</span><span class="w"> </span><span class="no">...</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nf">sd</span><span class="w"> </span><span class="no">a7</span><span class="p">,</span><span class="w"> </span><span class="mi">-248</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="nf">sd</span><span class="w"> </span><span class="no">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">-256</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="nf">addi</span><span class="w"> </span><span class="no">sp</span><span class="p">,</span><span class="no">sp</span><span class="p">,-</span><span class="mi">256</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="c1"># -----------</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">        </span><span class="c1"># 2. call trap_handler</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">        </span><span class="c1"># 要将 scause 和 sepc 的值依次传入作为参数传入函数</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">        </span><span class="c1"># 需要注意的是，不论是栈传参还是用a0，a1传参，都需要和后面的使用参数的方式统一</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="nf">csrr</span><span class="w"> </span><span class="no">a0</span><span class="p">,</span><span class="w"> </span><span class="no">scause</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="nf">csrr</span><span class="w"> </span><span class="no">a1</span><span class="p">,</span><span class="w"> </span><span class="no">sepc</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">trap_handler</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">    </span><span class="c1"># -----------</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">        </span><span class="c1"># 3. restore sepc and 32 registers (x2(sp) should be restore last) from stack</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">        </span><span class="c1"># 和第一部分一样，但是反向依次传回</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">    </span><span class="nf">ld</span><span class="w"> </span><span class="no">fp</span><span class="p">,</span><span class="w"> </span><span class="mi">00</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">    </span><span class="nf">ld</span><span class="w"> </span><span class="no">a7</span><span class="p">,</span><span class="w"> </span><span class="mi">08</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">    </span><span class="na">...</span><span class="w"> </span><span class="no">...</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="nf">ld</span><span class="w"> </span><span class="no">ra</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="nf">ld</span><span class="w"> </span><span class="no">sp</span><span class="p">,</span><span class="w"> </span><span class="mi">248</span><span class="p">(</span><span class="no">sp</span><span class="p">)</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">    </span><span class="c1"># -----------</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">        </span><span class="c1"># 4. return from trap</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">        </span><span class="c1"># 因为是从s态启动的一个trap，所以返回也需要用sret</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="nf">sret</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span><span class="c1"># -----------</span>
</span></code></pre></div>
<h2 id="34">3.4 实现异常处理函数<a class="headerlink" href="#34" title="点击此处可置顶内容">&para;</a></h2>
<p>需要修改 <code>arch/riscv/kernel/</code> 目录下的 <code>trap.c</code> 文件，完成以下目标：</p>
<ol>
<li>在 <code>trap.c</code> 中实现异常处理函数<code>trap_handler()</code> , 其接收的两个参数分别是 <code>scause</code> 和 <code>sepc</code> 两个寄存器中的值。</li>
<li>通过 <code>scause</code> 判断 <code>trap</code> 类型，如果是 <code>interrupt</code> 判断是否是 <code>timer interrupt</code></li>
<li>如果是 <code>timer interrupt</code> 则打印输出相关信息（即 4.6 节中输出的 <code>[S] Supervisor Mode Timer Interrupt</code>），并通过 <code>clock_set_next_event()</code> 设置下一次时钟中断 </li>
<li><code>clock_set_next_event()</code> 见 4.5 节 </li>
<li>其他interrupt / exception 可以直接忽略</li>
</ol>
<div class="language-c highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">trap_handler</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">scause</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sepc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="n">scause</span><span class="o">&gt;&gt;</span><span class="mi">63</span><span class="p">){</span><span class="w"> </span><span class="c1">//判断最高位</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="c1">//Interrupt</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">            </span><span class="k">switch</span><span class="p">(</span><span class="n">scause</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x7FFFFFFFFFFFFFFF</span><span class="p">){</span><span class="c1">//去除最高位</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">                    </span><span class="n">printk</span><span class="p">(</span><span class="s">&quot;[S] Supervisor Mode Timer Interrupt</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">                    </span><span class="n">clock_set_next_event</span><span class="p">();</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">                </span><span class="k">default</span><span class="o">:</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="c1">//Exception</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="35">3.5 实现时钟中断相关函数<a class="headerlink" href="#35" title="点击此处可置顶内容">&para;</a></h2>
<p>需要修改 <code>arch/riscv/kernel/</code> 目录下的 <code>clock.c</code> 文件，并完成以下目标：</p>
<ol>
<li>在 <code>clock.c</code> 中实现 <code>get_cycles()</code>：使用 <code>rdtime</code> 汇编指令获得当前 <code>time</code> 寄存器中的值。</li>
<li>在 <code>clock.c</code> 中实现 <code>clock_set_next_event()</code>：调用 <code>sbi_ecall</code> 的衍生函数 <code>sbi_set_timer</code> ，设置下一个时钟中断事件。
   <img alt="image-20240210211317591" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211317591.png" /> </li>
</ol>
<div class="language-c highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">TIMECLOCK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000000</span><span class="p">;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="c1">// QEMU中时钟的频率是10MHz, 也就是1秒钟相当于10000000个时钟周期。</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">get_cycles</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">ret_val</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="n">__asm__</span><span class="w"> </span><span class="k">volatile</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">        </span><span class="s">&quot;rdtime %[ret_val]&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">ret_val</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">ret_val</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;memory&quot;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret_val</span><span class="p">;</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="p">}</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">clock_set_next_event</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_cycles</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TIMECLOCK</span><span class="p">;</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">    </span><span class="n">sbi_set_timer</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<h2 id="36">3.6 编译与测试<a class="headerlink" href="#36" title="点击此处可置顶内容">&para;</a></h2>
<p>由于加入了一些新的 <code>.c</code> 文件，可能需要修改或添加一些 <code>Makefile</code> 或 <code>.h</code> 文件，请同学自己尝试修改，使项目可以编译并运行。</p>
<p>我们可以看到在最外层的 <code>Makefile</code> 文件并没有需要修改的地方，加上我们的debug和run都是使用spike完成，所以这个run和debug甚至可以被注释掉，完全用不着了。</p>
<p>然后我们依次检查 <code>./lib</code> <code>./init</code> <code>./arch/riscv</code> 三个目录下的 <code>Makefile</code> 文件，并做出如下修改：</p>
<div class="language-makefile highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c">#./lib</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span>...
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="si">${</span><span class="nv">GCC</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CFLAG</span><span class="si">}</span><span class="w"> </span>-c<span class="w"> </span>print.c
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span>...
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c">        #改为==&gt;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span>...
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="si">${</span><span class="nv">GCC</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">CFLAG</span><span class="si">}</span><span class="w"> </span>-c<span class="w"> </span>printk.c
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span>...
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c">#./init</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c">    #无修改</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="c">#./arch/riscv</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c">    #无修改</span>
</span></code></pre></div>
<p>首先证明一下再用spike：</p>
<p><img alt="image-20240210211327529" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211327529.png" /><img alt="image-20240210211320993" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211320993.png" /> </p>
<p>我们在_start位置插入断点，当执行到指令 <code>csrw stvec, a0</code> 时，检查寄存器的值看看是否正确地写入了：</p>
<p><img alt="image-20240210211330864" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211330864.png" /> </p>
<p><img alt="image-20240210211335393" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211335393.png" /> </p>
<p>可以看到我们的写入是正确的 <code>_traps</code> 的地址（0x80200040）。</p>
<p>继续执行，可以看到 <code>sie</code> 的值也正确的赋值了。</p>
<p><img alt="image-20240210211337386" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211337386.png" /> </p>
<p>这里也成功地将 <code>sstatus</code> 的第二位置为一。</p>
<p><img alt="image-20240210211339595" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211339595.png" /> </p>
<p>等到执行到 <code>j start_kernal</code> 的时候，程序就正常执行了。执行结果如下：</p>
<p><img alt="image-20240210211341438" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211341438.png" /> </p>
<h1 id="4">4 思考题<a class="headerlink" href="#4" title="点击此处可置顶内容">&para;</a></h1>
<h2 id="41-medeleg-mideleg">4.1 理解 <code>medeleg</code> 和<code>mideleg</code><a class="headerlink" href="#41-medeleg-mideleg" title="点击此处可置顶内容">&para;</a></h2>
<p><strong>题目描述：</strong></p>
<p>通过查看 <code>RISC-V Privileged Spec</code> 中的 <code>medeleg</code> 和 <code>mideleg</code> 解释上面 <code>MIDELEG</code> 值的含义，如果实验中 <code>mideleg</code> 没有设定为正确的值结果会怎么样呢？</p>
<p><strong>答：</strong></p>
<p>*<em>MIDELEG： *</em>Machine Interrupt Delegation Register 中断委派寄存器</p>
<p><strong>MEDELEG：</strong> Machine Exception Delegation Register 异常委派寄存器</p>
<p>这两个寄存器都是用于配置处理器如何处理异常和中断的寄存器。</p>
<p>而其中的 <code>mideleg</code> 寄存器用于配置哪些中断可以被委托给机器级别处理，而不是通过异常委托给特权模式处理。<code>mideleg</code>的每个位对应一个中断，当对应位被设置为1时，相应的中断将会被委托给机器模式处理。</p>
<p>本次实验中，<code>MIDELEG</code> 输出值为 0x222（0b1000100010），第 5 位为 1，对应中断 <code>Supervisor timer interrupt</code> 。根据手册的说明，如果其为 0，则不会进入我们编写的处理程序，也就不会输出对应消息。</p>
<h2 id="42-time-cycle">4.2 <code>time</code> 与 <code>cycle</code> 寄存器<a class="headerlink" href="#42-time-cycle" title="点击此处可置顶内容">&para;</a></h2>
<p><strong>题目描述：</strong></p>
<p>机器启动后 time、cycle 寄存器分别是从 0 开始计时的吗，从 0 计时是否是必要的呢？（有关 <code>mcycle</code> 寄存器的内容可以参考手册）</p>
<p><strong>答：</strong></p>
<p>在 <code>Spike</code> 下，调试查看对应的 <code>time</code> 和 <code>cycle</code> 寄存器的值。</p>
<p><img alt="image-20240210211420967" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211420967.png" /></p>
<p>在 <code>Qemu</code> 下，调试查看对应的 <code>time</code> 和 <code>cycle</code> 寄存器的值。</p>
<p><img alt="image-20240210211433252" src="../Lab4%20RV64%20%E4%B8%8B%E7%9A%84%E6%97%B6%E9%92%9F%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86img/image-20240210211433252.png" /></p>
<p>发现两者得到的结果居然不一样！在 <code>qemu</code> 中，time是0，cycle不是0，而在 <code>spike</code> 中，time和cycle都不是0。</p>
<p>因为time寄存器主要用于记录时间信息，它通常用于测量代码执行的相对时间，以便评估程序的运行时间和性能。通过读取time寄存器的值，可以得到代码执行的时间片或持续时间。</p>
<p>而cycle寄存器主要用于记录处理器内部时钟周期的数量。它通常用于测量代码执行的精确时钟周期数，以评估程序的性能和指令的执行效率。通过读取cycle寄存器的值，可以得到代码执行期间经过的时钟周期数。</p>
<p>我们实际上都可以通过记录开始时候的寄存器值和记录某一时刻的寄存器值，通过相减来得到这段时间内经过的时间或者周期数，因此实际上都不是很有必要从0开始。</p>
<h2 id="43">4.3 指令集扩展<a class="headerlink" href="#43" title="点击此处可置顶内容">&para;</a></h2>
<p><strong>题目描述：</strong></p>
<p>阅读 <a href="https://github.com/riscv/riscv-isa-manual/releases/download/Ratified-IMAFDQC/riscv-spec-20191213.pdf">The RISC-V Instruction Set Manual Volume I: Unprivileged ISA (V20191213)</a> 中第 1.2 章节 <code>RISC-V Software Execution Environments and Harts</code> ，谈谈如何在一台不支持乘除法指令扩展的处理器上执行乘除法指令。</p>
<p><strong>答：</strong></p>
<p>如果在一台不支持乘法指令扩展的处理器上遇到乘法指令会触发 <code>Illegal Instruction</code> 异常，会有以下几个相关的异常处理寄存器可以供我们使用：</p>
<ol>
<li><code>mcause</code>寄存器：<code>mcause</code>寄存器用于存储异常的原因。它有一个字段用于表示当前异常的原因代码。对于非法指令异常，其原因代码将指示为非法指令。<code>mcause</code>寄存器的位布局根据RISC-V架构的特定实现而有所不同。</li>
<li><code>mepc</code>寄存器：<code>mepc</code>寄存器用于存储导致异常的指令的地址。当异常发生时，处理器会将导致异常的指令的地址存储在<code>mepc</code>寄存器中，以便在异常处理程序中确定异常发生的位置。</li>
<li><code>mtval</code>寄存器：<code>mtval</code>寄存器用于存储导致异常的值。对于非法指令异常，<code>mtval</code>寄存器存储了引发异常的非法指令本身。</li>
</ol>
<p>因此我们可以从 <code>mcause</code> 中看到这个异常的原因，在 <code>mepc</code> 拿到异常指令的地址，可以从这里获取指令的内容，也可以直接从 <code>mtal</code> 寄存器中获取指令。在判断出异常后会进入到对应的异常处理函数中，我们可以在异常处理函数中根据上述获取到指令的方法，判断是否是乘除法，如果是乘法可以用连加来代替，如果是除法可以用连减来代替。最后处理结束后返回回对应的 <code>mepc</code> 处即发生异常的指令处即可。</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../Lab3/Lab3%EF%BC%9ARV64%E5%86%85%E6%A0%B8%E5%BC%95%E5%AF%BC%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Lab3">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Lab3
              </div>
            </div>
          </a>
        
        
          
          <a href="../../Lab5/Lab5%EF%BC%9ARV64%20%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6/" class="md-footer__link md-footer__link--next" aria-label="下一页: Lab5">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Lab5
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ZJUCCnocc/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "toc.follow", "search.highlight", "search.share", "content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.footer", "navigation.path", "navigation.prune", "navigation.tabs"], "search": "../../../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../../../../../assets/javascripts/katex.js"></script>
      
        <script src="../../../../../../assets/javascripts/mathjax.js"></script>
      
        <script src="../../../../../../assets/javascripts/fireworks.js"></script>
      
        <script src="https://cdn.tonycrane.cc/utils/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../../../assets/javascripts/glightbox.min.js"></script>
      
    
  </body>
</html>